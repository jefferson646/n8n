{"createdAt":"2025-11-30T16:11:38.129Z","updatedAt":"2025-11-30T16:11:38.129Z","id":"iqnydB9DyqMazWgj","name":"IPTV - Agente Otimizado com RAG","active":false,"isArchived":false,"nodes":[{"parameters":{"path":"/IPTV","options":{}},"name":"Webhook2","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-112,-208],"webhookId":"{{ $parameters.path }}","id":"52581507-bc1d-47ac-a7dd-3f27a0844e40"},{"parameters":{"options":{}},"name":"Extrair Mensagem","type":"n8n-nodes-base.set","typeVersion":3,"position":[208,0],"id":"bb087f2e-2918-4fcd-a014-923d2127b955"},{"parameters":{"method":"POST","url":"https://api.openai.com/v1/embeddings","authentication":"generic","options":{}},"name":"OpenAI Embeddings","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[400,0],"id":"095350bb-7c26-453c-8c71-460efb928599"},{"parameters":{"method":"POST","url":"={{ $env.SUPABASE_URL }}/rest/v1/rpc/match_knowledge","authentication":"generic","options":{}},"name":"RAG Query","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[608,0],"id":"4f3de332-5dcc-4a79-8f1f-4bfe138bb857"},{"parameters":{},"name":"Formatar Contexto RAG","type":"n8n-nodes-base.code","typeVersion":1,"position":[800,0],"id":"be6eee26-2fd9-47b5-831c-1bcde1570659"},{"parameters":{},"name":"Preparar para AI Agent","type":"n8n-nodes-base.code","typeVersion":1,"position":[1008,0],"id":"c15f19ee-d6e3-4830-b32d-8b0200ef7a4d"},{"parameters":{"promptType":"define","text":"=**MENSAGEM DO CLIENTE:**\n{{ $json.Mensagem }}\n\n---\n\n**CONTEXTO DISPONÃVEL:**\n{{ $json.ContextoRAG }}\n\n---","options":{"systemMessage":"=VocÃª Ã© o *Cinebot* ðŸ¤–, assistente de suporte tÃ©cnico SUPER amigÃ¡vel da *Cine Magic Plus IPTV*.\n\n# [SUA PERSONALIDADE - IMPORTANTE!]\nâœ… AmigÃ¡vel: \"Opa!\", \"Blz!\", \"Show!\" ðŸ˜Š\nâœ… Breve: MÃ¡ximo 3 linhas por mensagem\nâœ… Ãštil: SoluÃ§Ãµes prÃ¡ticas e diretas\nâœ… Honesto: \"Deixa eu chamar um especialista\"\nâœ… Um pouco brincalhÃ£o: Pode usar humor leve\nâœ… Sempre presente: Responda rÃ¡pido\n\nâŒ Chato: Nunca insista se cliente recusar\nâŒ Formal: Zero linguagem robÃ³tica\nâŒ Longo: Nada de textÃ£o\nâŒ Falso: Nunca invente informaÃ§Ã£o\n\n# [DADOS DO CLIENTE - USE SEMPRE]\nUse os dados disponÃ­veis no contexto.\n\n# [CONTEXTO DO RAG - SEMPRE USE]\nO contexto acima contÃ©m documentos relevantes. USE SEMPRE!\n\n# [GATILHOS DE FERRAMENTA] ðŸ”§\n\nSE cliente diz: \"renovar\", \"pagar\", \"PIX\", \"gerar PIX\", \"quero pagar\"\nâ†’ Mencione que vai gerar link de pagamento\n\nSE cliente diz: \"jogo\", \"futebol\", \"partida\", \"que jogo passa\", \"tem jogo\"\nâ†’ Responda sobre jogos do dia\n\nSE cliente pede: \"falar com atendente\", \"humano\", \"especialista\"\nâ†’ Transfira para humano\n\nSE vocÃª NÃƒO TEM CERTEZA da resposta:\nâ†’ NÃƒO INVENTE! Escale para humano.\n\n# [RESTRIÃ‡Ã•ES ABSOLUTAS] ðŸš«\nâŒ NUNCA invente dados\nâŒ NUNCA ofereÃ§a teste (cliente jÃ¡ Ã© ativo!)\nâŒ NUNCA prometa coisa que nÃ£o sabe\nâŒ NUNCA envie textÃ£o (mÃ¡x 6-7 linhas)\nâŒ NUNCA use mais de 2 emojis por mensagem\n\n# [FORMATO DAS RESPOSTAS]\nâœ… Negrito: *texto*\nâœ… NÃºmeros: 1ï¸âƒ£ 2ï¸âƒ£ 3ï¸âƒ£\nâœ… Listas: âœ… âŒ\nâœ… EspaÃ§amento visual\nâŒ Sem cÃ³digo ou comandos tÃ©cnicos\n\n# [EMOJIS PERMITIDOS]\nðŸ“º ðŸ“± ðŸ’» ðŸ”§ âœ… âŒ ðŸ’¡ ðŸ“ž ðŸ’° âœ¨ ðŸ˜Š ðŸš€ ðŸŽ‰ ðŸŽ â˜• ðŸ’ª ðŸ“¸ ðŸ”— ðŸ“² ðŸ‘ ðŸ‘¤ â³\n\n# [EXEMPLOS]\n\nCliente: \"Oi, tÃ¡ travando aqui\"\nVocÃª: \"*Vamos resolver!* ðŸ”§\n\n1ï¸âƒ£ Desligue a TV da tomada\n2ï¸âƒ£ Aguarde 1 minuto\n3ï¸âƒ£ Religue a TV\n\nFuncionou? ðŸ˜Š\"\n\nCliente: \"Qual meu usuÃ¡rio?\"\nVocÃª: \"Aqui estÃ¡! ðŸ‘¤\n\nQual Ã© sua dÃºvida especÃ­fica?\nTenho a resposta aqui!\"\n\n# [IMPORTANTE]\nðŸŽ¯ Seu objetivo: RESOLVER o problema na PRIMEIRA conversa\nðŸŽ¯ Ser rÃ¡pido: mÃ¡x 30 segundos\nðŸŽ¯ Ser honesto: se nÃ£o sabe, escala\nðŸŽ¯ Ser amigÃ¡vel: cliente Ã© seu amigo\nðŸŽ¯ Ser eficiente: 3 linhas > 10 parÃ¡grafos\n\nSeja genuÃ­no, divertido (mas profissional), e sempre com foco em RESOLVER! ðŸš€"}},"name":"AI Agent - Clientes Ativos","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[1200,0],"id":"24a2da04-1e30-4183-a2cb-2cfdd0fd9187"},{"parameters":{"options":{}},"name":"Enviar Resposta","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1488,0],"id":"584ffdf3-a230-4998-9eb9-3c3bb06de052"},{"parameters":{"mode":"retrieve-as-tool","tableName":{"__rl":true,"value":"knowledge_base","mode":"list","cachedResultName":"knowledge_base"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[1504,304],"id":"9024f4aa-8740-4a14-a3f6-bda5ec93eed8","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"YiyVBOXMUDSxpE6T","name":"Supabase account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[1488,448],"id":"9dbc975f-d669-4f5c-8b1a-8f93ba7e4ea9","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"4sjzZXZce2WTB5CT","name":"IPTV"}}},{"parameters":{"public":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.3,"position":[16,0],"id":"d775ff82-7d31-409f-808a-922ec7716cb9","name":"When chat message received","webhookId":"9f2f7f71-40fe-40bd-8721-7bf1dfdcf80e"}],"connections":{"Webhook2":{"main":[[]]},"Extrair Mensagem":{"main":[[{"node":"OpenAI Embeddings","type":"main","index":0}]]},"OpenAI Embeddings":{"main":[[{"node":"RAG Query","type":"main","index":0}]]},"RAG Query":{"main":[[{"node":"Formatar Contexto RAG","type":"main","index":0}]]},"Formatar Contexto RAG":{"main":[[{"node":"Preparar para AI Agent","type":"main","index":0}]]},"Preparar para AI Agent":{"main":[[{"node":"AI Agent - Clientes Ativos","type":"main","index":0}]]},"AI Agent - Clientes Ativos":{"main":[[{"node":"Enviar Resposta","type":"main","index":0}]]},"Supabase Vector Store":{"ai_tool":[[{"node":"AI Agent - Clientes Ativos","type":"ai_tool","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"When chat message received":{"main":[[{"node":"Extrair Mensagem","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"7a0df3d4-3001-4a80-91bb-1dd6ca1bf593","triggerCount":0,"shared":[{"createdAt":"2025-11-30T16:11:38.129Z","updatedAt":"2025-11-30T16:11:38.129Z","role":"workflow:owner","workflowId":"iqnydB9DyqMazWgj","projectId":"cHLAHCCuTHxRR7pJ"}],"tags":[]}