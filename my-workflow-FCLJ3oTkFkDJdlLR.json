{"createdAt":"2025-08-18T23:11:29.730Z","updatedAt":"2025-08-30T18:27:32.647Z","id":"FCLJ3oTkFkDJdlLR","name":"My workflow","active":false,"isArchived":false,"nodes":[{"parameters":{"path":"dba8a87c-5255-4746-b6f2-ea9348ace1a5","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[720,224],"id":"b85929a4-6e0d-4e07-b14d-ecb8895a14ea","name":"Webhook","webhookId":"dba8a87c-5255-4746-b6f2-ea9348ace1a5"},{"parameters":{"respondWith":"text","responseBody":"<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n  <meta charset=\"utf-8\"/>\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/>\n  <title>Leitor de QR – Paletes</title>\n  <style>\n    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:16px}\n    .card{border:1px solid #ddd;border-radius:12px;padding:16px;margin-bottom:12px}\n    button{padding:12px 16px;border-radius:10px;border:1px solid #ccc;cursor:pointer}\n    #preview{width:100%;max-width:520px;border-radius:12px}\n    .row{display:flex;gap:8px;flex-wrap:wrap}\n    input,select{padding:10px;border-radius:8px;border:1px solid #ccc;width:100%}\n    .ok{color:green}.err{color:#b00}\n  </style>\n</head>\n<body>\n  <h2>Leitor de QR – Paletes</h2>\n\n  <div class=\"card\">\n    <label>Operador</label>\n    <input id=\"operator\" placeholder=\"Seu nome ou matrícula\"/>\n    <label>Estação / Local</label>\n    <input id=\"station\" placeholder=\"Ex.: doca-01\"/>\n  </div>\n\n  <div class=\"card\">\n    <video id=\"preview\" autoplay playsinline></video>\n    <div class=\"row\" style=\"margin-top:10px\">\n      <button id=\"start\">Iniciar câmera</button>\n      <button id=\"stop\">Parar</button>\n    </div>\n  </div>\n\n  <div class=\"card\" id=\"result\" hidden>\n    <h3>Dados lidos</h3>\n    <pre id=\"json\" style=\"white-space:pre-wrap\"></pre>\n    <div class=\"row\">\n      <button id=\"btn-in\">Confirmar ENTRADA</button>\n      <button id=\"btn-out\">Confirmar SAÍDA</button>\n    </div>\n    <div id=\"resp\"></div>\n  </div>\n\n  <script src=\"https://unpkg.com/@zxing/browser@latest\"></script>\n  <script>\n    const N8N_URL = \"https://SEU-DOMINIO/webhook/qr/scan\"; // <- troque aqui\n    let codeReader, controls;\n\n    const $ = (id)=>document.getElementById(id);\n    const state = { lastPayload: null };\n\n    async function startCam(){\n      codeReader = new ZXingBrowser.BrowserMultiFormatReader();\n      const video = $('preview');\n\n      const devices = await ZXingBrowser.BrowserCodeReader.listVideoInputDevices();\n      const backCam = devices.find(d => /back|traseira|rear/i.test(d.label))?.deviceId || devices[0]?.deviceId;\n\n      controls = await codeReader.decodeFromVideoDevice(backCam, video, (result, err) => {\n        if(result){\n          try{\n            const text = result.getText();\n            const payload = JSON.parse(text);\n            state.lastPayload = payload;\n            $('json').textContent = JSON.stringify(payload, null, 2);\n            $('result').hidden = false;\n          }catch(e){\n            $('json').textContent = \"QR inválido (não é JSON). Texto: \" + result.getText();\n            $('result').hidden = false;\n          }\n        }\n      });\n    }\n    function stopCam(){\n      controls?.stop();\n      codeReader?.reset();\n    }\n\n    async function send(action){\n      const operator = $('operator').value.trim();\n      const station = $('station').value.trim();\n      const payload = state.lastPayload;\n      if(!payload) return;\n\n      if(!operator){ alert('Informe o Operador'); return; }\n      const event_uid = crypto.randomUUID?.() || String(Date.now());\n      const body = { action, operator, station, event_uid, payload };\n\n      const r = await fetch(N8N_URL, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(body)\n      });\n      const j = await r.json().catch(()=>({}));\n      $('resp').innerHTML = r.ok\n        ? `<p class=\"ok\">OK: ${j.message||'Registrado'} (status: ${j.next_status||'-'})</p>`\n        : `<p class=\"err\">ERRO: ${j.message||r.status}</p>`;\n    }\n\n    $('start').onclick = startCam;\n    $('stop').onclick = stopCam;\n    $('btn-in').onclick = ()=>send('IN');\n    $('btn-out').onclick = ()=>send('OUT');\n  </script>\n</body>\n</html>\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[928,224],"id":"7e601d48-4642-4d85-b762-e8993f730bd5","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"e75eb8da-413c-42ba-8ccc-76b879caaf03","triggerCount":1,"tags":[]}